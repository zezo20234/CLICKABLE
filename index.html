<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Zezo Clicker — Full Release (CPS & Shiny Medals) — Mobile Friendly</title>

<!-- Fallback favicon / progressive web manifest -->
<link rel="icon" type="image/png" sizes="512x512" href="/roblox.png">
<link rel="manifest" href="/manifest.json">

<!-- iOS home-screen icon & web-app meta (for iPhones) -->
<link rel="apple-touch-icon" sizes="180x180" href="/roblox.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Zezo Clicker">

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<style>
  :root{
    --bg-a: #071022;
    --bg-b: #001d2d;
    --cta: #ff8a00;
    --panel: rgba(255,255,255,0.03);
    --muted: rgba(230,238,246,0.6);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial; background: linear-gradient(160deg,var(--bg-a), var(--bg-b)); color:#e6eef6;-webkit-font-smoothing:antialiased}
  body{min-height:100vh}
  .container{max-width:980px;margin:18px auto;padding:18px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; padding:16px; box-shadow: 0 6px 20px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03)}
  .center{display:flex;align-items:center;justify-content:center}
  input, select {width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;font-size:16px}

  button{cursor:pointer;border:0;padding:12px 14px;border-radius:10px;font-weight:800;line-height:1}
  .btn-primary{background:linear-gradient(90deg,var(--cta), #ffb86b); color:#06101a}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit}

  h1,h2{margin:6px 0 10px}
  .muted{color:var(--muted);font-size:13px}

  /* GAME LAYOUT */
  .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;flex-wrap:wrap}
  .stats{display:flex;gap:12px;align-items:center}
  .stat{background:var(--panel);padding:10px 12px;border-radius:10px;font-weight:700;min-width:110px;text-align:center}
  /* make click area taller and responsive */
  #game-area{margin:6px 0;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;cursor:pointer;user-select:none;touch-action:none}
  /* desktop default: nice tall area */
  #game-area{height:68vh; max-height:calc(100vh - 220px);}
  #click-hint{font-size:20px;padding:8px;text-align:center}

  /* CPS overlay */
  .cps-badge{position:absolute;left:12px;top:12px;background:rgba(0,0,0,0.45);padding:10px 12px;border-radius:12px;font-weight:800;backdrop-filter: blur(6px);border:1px solid rgba(255,255,255,0.04)}
  .cps-badge strong{display:block;font-size:16px}
  .cps-badge span{font-size:13px;opacity:0.95}

  /* ripple */
  .ripple{position:absolute;border-radius:50%;transform:translate(-50%,-50%);pointer-events:none;opacity:0.55}

  /* controls */
  .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .small{font-size:14px;padding:10px 12px;border-radius:10px}
  .spin-wheel{width:60px;height:60px;border-radius:50%;display:grid;place-items:center;font-weight:800;background:linear-gradient(180deg,#fff6e8,#ffd19c);color:#3b1f00;box-shadow:0 8px 30px rgba(255,138,0,0.12)}
  .spin-disabled{opacity:0.45;pointer-events:none}

  /* medals panel */
  .medals-wrap{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;margin-top:12px}
  .medal-card{perspective:900px;height:120px}
  .medal-inner{width:100%;height:100%;border-radius:16px;position:relative;transform-style:preserve-3d;transition:transform 0.18s linear}
  .medal-front, .medal-back{position:absolute;inset:0;border-radius:16px;display:flex;align-items:center;justify-content:center;backface-visibility:hidden;font-weight:800}
  .medal-front{background:linear-gradient(135deg,#ffd54a,#ffc107);color:#3b2200;font-size:16px;box-shadow: 0 6px 18px rgba(0,0,0,0.35);position:relative;overflow:hidden}
  .medal-front::after{content:'';position:absolute;inset:0;background:linear-gradient(120deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));mix-blend-mode:screen;pointer-events:none}
  .medal-front.shiny{box-shadow: 0 10px 30px rgba(255,200,40,0.18), 0 0 30px rgba(255,200,40,0.06) inset}
  .medal-back{background:linear-gradient(135deg,#0b1220,#0f1822);transform:rotateY(180deg);color:#9fb7c5;font-size:12px;flex-direction:column;gap:6px;padding:10px;text-align:center}
  .medal-draggable{cursor:grab}

  /* shiny pulse for newly earned */
  .new-medal{animation:newPulse .9s ease}
  @keyframes newPulse{0%{transform:scale(0.9);opacity:0}50%{transform:scale(1.06);opacity:1}100%{transform:scale(1);opacity:1}}

  /* medal-area green flash animation (used instead of pop-up notifications) */
  .medal-flash {
    animation: medalFlash 1.1s ease;
  }
  @keyframes medalFlash {
    0% {
      box-shadow: 0 0 0 rgba(0,0,0,0);
      transform: translateY(0);
    }
    15% {
      box-shadow: 0 10px 40px rgba(76,175,80,0.32), inset 0 0 18px rgba(76,175,80,0.06);
      transform: translateY(-2px);
    }
    55% {
      box-shadow: 0 12px 60px rgba(76,175,80,0.24), inset 0 0 14px rgba(76,175,80,0.04);
      transform: translateY(0);
    }
    100% {
      box-shadow: 0 0 0 rgba(0,0,0,0);
      transform: translateY(0);
    }
  }

  /* modal / challenge UI */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center}
  .modal-card{background:#07111a;padding:18px;border-radius:12px;min-width:320px;color:white}

  .big-click{width:220px;height:220px;border-radius:50%;display:grid;place-items:center;background:linear-gradient(180deg,#ff8a00,#ffca78);font-weight:900;color:#2f1200;cursor:pointer;font-size:28px;box-shadow:0 8px 30px rgba(0,0,0,0.4)}
  .challenge-stats{display:flex;gap:12px;margin-top:12px}

  /* admin messages (moved to top-right) */
  #admin-messages {
    position: absolute;
    right: 12px;
    top: 12px;
    left: auto;
    transform: none;
    pointer-events: none; /* messages don't block game clicks */
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 10px;
    z-index: 9999;
    max-width:40%;
  }
  .admin-msg {
    pointer-events: auto;
    background: linear-gradient(180deg, rgba(0,0,0,0.75), rgba(0,0,0,0.6));
    padding: 12px 16px;
    border-radius: 12px;
    color: white;
    min-width: 220px;
    max-width: 100%;
    box-shadow: 0 12px 30px rgba(0,0,0,0.6);
    text-align: right;
    font-weight: 800;
    font-size: 15px;
    border: 1px solid rgba(255,255,255,0.04);
    transform: translateY(0);
    opacity: 0;
    animation: admin-pop-tr .28s ease forwards;
  }
  @keyframes admin-pop-tr { from { transform: translateY(-8px) translateX(8px); opacity: 0 } to { transform: translateY(0); transform: none; opacity: 1 } }

  .admin-medal {
    background: linear-gradient(135deg,#ffd54a,#ffc107);
    color: #3b2200;
    font-weight:900;
    padding: 12px 16px;
    border-radius: 12px;
    box-shadow: 0 12px 30px rgba(255,200,40,0.12);
    text-align: right;
  }

  .admin-from { font-size: 13px; opacity: 0.85; font-weight:700; margin-bottom:6px }
  .admin-expire { font-size:12px; opacity:0.75; margin-top:8px; font-weight:600 }

  .invisible { display: none; }

  .footer{margin-top:12px;color:var(--muted);font-size:13px}

  /* keep signed label */
  .keep-row{display:flex;align-items:center;gap:8px;margin-top:6px}
  .keep-row input[type="checkbox"]{width:18px;height:18px}

  /* small-screen adjustments */
  @media (max-width: 920px){
    .container{padding:14px;margin:12px auto}
    #game-area{height:72vh; max-height:calc(100vh - 200px)}
    .stats{gap:8px}
    .stat{min-width:88px;padding:8px}
    .admin-msg{min-width:180px}
  }

  @media (max-width: 720px){
    .container{padding:12px;margin:10px}
    /* push the click area to occupy most of the viewport height on phones */
    #game-area{height:calc(100vh - 220px); max-height:calc(100vh - 140px); border-radius:12px}
    .stat{min-width:72px;padding:8px;font-size:14px}
    .big-click{width:160px;height:160px;font-size:20px}
    .medals-wrap{grid-template-columns:repeat(auto-fit,minmax(140px,1fr))}
    .btn-primary,.btn-ghost{padding:12px 14px;font-size:15px}
    input,select{padding:12px;font-size:16px}
    .cps-badge{left:10px;top:10px;padding:10px 12px}
    #admin-messages{right:8px;top:8px;max-width:46%}
    .card{padding:12px}
    .muted{font-size:13px}
  }

  @media (max-height:600px){
    /* shorter devices: still keep click area usable */
    #game-area{height:62vh}
    .container{padding:10px}
  }
</style>
</head>
<body>
  <div class="container">
    <!-- LOGIN CARD -->
    <div id="login-card" class="card center">
      <div style="width:100%;max-width:480px">
        <h1 class="center">Zezo Clicker</h1>
        <div style="display:grid;gap:12px">
          <input id="username" type="text" placeholder="Username (zezo / lilly / asser)" autocomplete="off" autocapitalize="off">
          <input id="password" type="password" placeholder="Password" autocomplete="new-password">
          <div class="keep-row">
            <input id="keep-signed" type="checkbox">
            <label for="keep-signed" class="muted" style="cursor:pointer">Keep me signed in (auto-login)</label>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button id="login-btn" class="btn-primary">Login</button>
            <button id="help-btn" class="btn-ghost">How to play</button>
          </div>
          <div id="login-msg" class="muted">Login required. Passwords are not shown anywhere in the UI.</div>
        </div>
      </div>
    </div>

    <!-- GAME UI -->
    <div id="game-ui" class="invisible">
      <div class="topbar">
        <div>
          <h2 id="welcome">Welcome —</h2>
          <div id="logged-as" class="muted"></div>
          <div id="playtime" class="muted" style="margin-top:6px">Playtime: 0h 0m 0s</div>
        </div>

        <div class="stats">
          <div class="stat">💰 <span id="money">0</span>$</div>
          <div class="stat">🎯 Goal: <span id="goal">7000</span>$</div>
          <div class="stat" id="medal-stat">🏅 Medals: <span id="medal-count">0</span></div>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <button id="challenge-open" class="small btn-primary">⚔️ Challenge</button>
          <button id="medals-open" class="small btn-ghost">🏅 Medals</button>
          <button id="logout" class="small btn-ghost">Logout</button>
          <button id="reset" class="small btn-ghost">Reset</button>
        </div>
      </div>

      <div id="game-area" class="card" aria-label="Click area" role="button">
        <div id="click-hint">Click anywhere inside this area to earn money. Use challenges to win big.</div>
        <div id="effects" style="position:absolute;inset:0;pointer-events:none"></div>

        <!-- CPS & click value badge -->
        <div class="cps-badge">
          <strong id="cps">0</strong>
          <span>Clicks / sec — Value: <span id="click-value">1</span></span>
        </div>

        <!-- admin messages appear here (top-right) -->
        <div id="admin-messages" aria-hidden="true"></div>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px;gap:10px;flex-wrap:wrap">
        <div class="controls">
          <!-- SPINNER REMOVED -->
          <div style="min-width:160px">
            <div id="spin-feedback" class="muted" style="font-size:13px">Spin feature removed.</div>
          </div>
        </div>

        <div class="muted" style="font-size:13px">Tip: Click faster when you have higher click value. Reach the goal to earn medals.</div>
      </div>

      <div id="medals-panel" class="card" style="margin-top:14px;display:none">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3 style="margin:0">Your Medals</h3>
          <div class="muted">Drag each medal to rotate in 3D — click to flip — hold to delete</div>
        </div>
        <div id="medals-list" class="medals-wrap" style="margin-top:12px"></div>
        <div class="footer">Each time you reach the goal you earn a medal and the next goal increases by $500. Medals now include reasons.</div>
      </div>
    </div>
  </div>

  <!-- challenge modal -->
  <div id="challenge-modal" class="modal invisible">
    <div class="modal-card">
      <h3>Create Challenge</h3>
      <div style="display:grid;gap:8px;margin-top:8px">
        <label>Opponent
          <select id="challenge-opponent"></select>
        </label>
        <label>Clicks
          <select id="challenge-clicks">
            <option value="100">100</option>
            <option value="200">200</option>
            <option value="300">300</option>
            <option value="500">500</option>
            <option value="1000">1000</option>
          </select>
        </label>
        <label>Bet ($)
          <input id="challenge-bet" type="number" min="500" step="100" value="500">
        </label>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
          <button id="challenge-send" class="btn-primary">Send</button>
          <button id="challenge-cancel" class="btn-ghost">Cancel</button>
        </div>
        <div id="challenge-msg" class="muted"></div>
      </div>
    </div>
  </div>

  <!-- incoming invitation modal -->
  <div id="incoming-modal" class="modal invisible">
    <div class="modal-card">
      <h3>Challenge Invitation</h3>
      <div id="incoming-info" class="muted" style="margin-top:8px"></div>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="accept-invite" class="btn-primary">Accept</button>
        <button id="decline-invite" class="btn-ghost">Decline</button>
      </div>
    </div>
  </div>

  <!-- duel modal -->
  <div id="duel-modal" class="modal invisible">
    <div class="modal-card" style="min-width:360px">
      <h3 id="duel-title">Duel</h3>
      <div class="challenge-area">
        <div id="duel-target" class="muted"></div>
        <div id="duel-click" class="big-click" role="button" aria-label="Duel click target">CLICK</div>
        <div class="challenge-stats">
          <div class="muted">You: <span id="duel-your-count">0</span></div>
          <div class="muted">Opp: <span id="duel-op-count">0</span></div>
        </div>
        <div id="duel-result" class="muted" style="margin-top:8px"></div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
          <button id="duel-leave" class="btn-ghost">Leave</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* ================= CONFIG ================= */
const firebaseConfig = {
  apiKey: "AIzaSyAooLq0iO6pt7cEAu7VpdYmHEAyANsH4z8",
  authDomain: "hatch-647fa.firebaseapp.com",
  databaseURL: "https://hatch-647fa-default-rtdb.firebaseio.com",
  projectId: "hatch-647fa",
  storageBucket: "hatch-647fa.firebasestorage.app",
  messagingSenderId: "1002694901238",
  appId: "1:1002694901238:web:5c51840b40ea625e189bd7",
  measurementId: "G-SSNDLN72PE"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ========== STATIC USERS (no visible passwords) ========== */
const USERS = ['zezo','lilly','asser'];
const PASSWORDS = { zezo:'000', lilly:'246', asser:'230' };

/* ========== STATE ========== */
let currentUser = null;
let money = 0;
let goal = 7000;
let medals = [];
let resets = 0;
let clickValue = 1;
let saveTimer = null;
let activeRoomListeners = {};
let currentInvitation = null;
let currentRoomId = null;

// CPS tracking
let clickTimestamps = [];
let bestCPS = 0;
let lastCPS = 0;

// Playtime tracking (seconds)
let playSeconds = 0;
let playInterval = null;

/* ========== DOM ========== */
const loginCard = document.getElementById('login-card');
const loginBtn = document.getElementById('login-btn');
const helpBtn = document.getElementById('help-btn');
const usernameInp = document.getElementById('username');
const passwordInp = document.getElementById('password');
const keepSignedChk = document.getElementById('keep-signed');
const loginMsg = document.getElementById('login-msg');

const gameUi = document.getElementById('game-ui');
const welcomeEl = document.getElementById('welcome');
const loggedAs = document.getElementById('logged-as');
const playtimeEl = document.getElementById('playtime');
const moneyEl = document.getElementById('money');
const goalEl = document.getElementById('goal');
const medalCountEl = document.getElementById('medal-count');
const gameArea = document.getElementById('game-area');
const effects = document.getElementById('effects');
const spinFeedback = document.getElementById('spin-feedback');
const medalsPanel = document.getElementById('medals-panel');
const medalsList = document.getElementById('medals-list');
const medalsOpen = document.getElementById('medals-open');
const challengeOpen = document.getElementById('challenge-open');
const logoutBtn = document.getElementById('logout');
const resetBtn = document.getElementById('reset');
const cpsEl = document.getElementById('cps');
const clickValueEl = document.getElementById('click-value');

const adminMessagesContainer = document.getElementById('admin-messages');

/* challenge modal elements */
const challengeModal = document.getElementById('challenge-modal');
const opponentSelect = document.getElementById('challenge-opponent');
const clicksSelect = document.getElementById('challenge-clicks');
const betInput = document.getElementById('challenge-bet');
const challengeSend = document.getElementById('challenge-send');
const challengeCancel = document.getElementById('challenge-cancel');
const challengeMsg = document.getElementById('challenge-msg');

const incomingModal = document.getElementById('incoming-modal');
const incomingInfo = document.getElementById('incoming-info');
const acceptInvite = document.getElementById('accept-invite');
const declineInvite = document.getElementById('decline-invite');

const duelModal = document.getElementById('duel-modal');
const duelTitle = document.getElementById('duel-title');
const duelTarget = document.getElementById('duel-target');
const duelClick = document.getElementById('duel-click');
const duelYourCount = document.getElementById('duel-your-count');
const duelOpCount = document.getElementById('duel-op-count');
const duelResult = document.getElementById('duel-result');
const duelLeave = document.getElementById('duel-leave');

const medalStatContainer = document.getElementById('medal-stat');

/* ========== HELPERS ========== */
function uid(){ return (Date.now().toString(36) + Math.random().toString(36).slice(2,9)); }
function nowTs(){ return Date.now(); }
function show(el){ el.classList.remove('invisible'); }
function hide(el){ el.classList.add('invisible'); }

/* small temporary message (top-right) */
function showTempMessage(text, timeout=2500){
  const el = document.createElement('div');
  el.className = 'admin-msg';
  el.innerHTML = `<div style="font-weight:900">${text}</div>`;
  adminMessagesContainer.prepend(el);
  setTimeout(()=> el.remove(), timeout);
}

/* Throttle save */
function throttleSave(){
  if(saveTimer) clearTimeout(saveTimer);
  saveTimer = setTimeout(()=>{ saveProgress(); saveTimer = null; }, 1400);
}

/* ripple effect */
function makeRipple(x,y){
  const r = document.createElement('div');
  r.className = 'ripple';
  const size = Math.max(40, Math.min(gameArea.clientWidth, gameArea.clientHeight) * 0.18);
  r.style.width = r.style.height = size + 'px';
  r.style.left = x + 'px';
  r.style.top = y + 'px';
  r.style.background = 'radial-gradient(circle, rgba(255,255,255,0.55), rgba(255,255,255,0.02))';
  effects.appendChild(r);
  r.animate([{transform:'translate(-50%,-50%) scale(0.2)', opacity:0.7},{transform:'translate(-50%,-50%) scale(2.6)', opacity:0}], {duration:700, easing:'cubic-bezier(.2,.9,.3,1)'});
  setTimeout(()=>r.remove(),760);
}

/* animate money */
let moneyAnim = null;
function animateMoney(to){
  if(moneyAnim) cancelAnimationFrame(moneyAnim);
  const from = Number(moneyEl.textContent) || 0;
  const duration = 240;
  const start = performance.now();
  function step(t){
    const p = Math.min(1, (t - start)/duration);
    const v = Math.round(from + (to - from) * (1 - Math.pow(1 - p, 2)));
    moneyEl.textContent = v;
    if(p < 1) moneyAnim = requestAnimationFrame(step);
    else { moneyAnim = null; moneyEl.textContent = to; }
  }
  moneyAnim = requestAnimationFrame(step);
}

/* format playtime */
function formatPlaytime(s){
  const hrs = Math.floor(s/3600);
  const mins = Math.floor((s%3600)/60);
  const secs = s%60;
  return `${hrs}h ${mins}m ${secs}s`;
}

/* Award playtime medals up to current playSeconds (used on load to retroactively grant missed medals) */
function awardPlaytimeMedalsUpTo(seconds){
  const count = Math.floor(seconds / 900); // how many 15-min intervals
  for(let i=1;i<=count;i++){
    const minutes = i * 15;
    const type = 'play_' + minutes;
    if(!hasMedalType(type)){
      awardMedal(type, `${minutes} min Played`, `Played for ${minutes} minutes.`);
    }
  }
}

/* Start play timer */
function startPlayTimer(){
  if(playInterval) return;
  playInterval = setInterval(()=>{
    if(!currentUser) return; // only count when logged in
    const prev = playSeconds;
    playSeconds += 1;
    // update UI every second (cheap)
    playtimeEl.textContent = 'Playtime: ' + formatPlaytime(playSeconds);

    // Check for new 15-minute milestones crossed
    const prevCount = Math.floor(prev / 900);
    const newCount = Math.floor(playSeconds / 900);
    if(newCount > prevCount){
      for(let k = prevCount + 1; k <= newCount; k++){
        const minutes = k * 15;
        const type = 'play_' + minutes;
        if(!hasMedalType(type)){
          awardMedal(type, `${minutes} min Played`, `Played for ${minutes} minutes.`);
          showTempMessage(`Milestone: ${minutes} minutes played`);
        }
      }
    }

    // periodic save every minute to be gentle
    if(playSeconds % 60 === 0) throttleSave();
  }, 1000);
}

function stopPlayTimer(){ if(playInterval) { clearInterval(playInterval); playInterval = null; } }

/* ========== LOGIN / PRESENCE ========== */
loginBtn.addEventListener('click', ()=>{
  const u = usernameInp.value.trim().toLowerCase();
  const p = passwordInp.value;
  if(!u || !p) { loginMsg.textContent = 'Enter username & password'; return; }
  if(!USERS.includes(u)){ loginMsg.textContent = 'Unknown user'; return; }
  if(PASSWORDS[u] !== p){ loginMsg.textContent = 'Invalid credentials'; return; }
  // success
  currentUser = u;
  // persistent sign-in
  if(keepSignedChk.checked){
    try { localStorage.setItem('zezo_clicker_user', currentUser); } catch(e){}
  } else {
    try { localStorage.removeItem('zezo_clicker_user'); } catch(e){}
  }
  startSession();
});

helpBtn.addEventListener('click', ()=> alert('Click in the big area to earn money. Reach goal to get medals. New medals are awarded for records and special achievements. Hold a medal to delete it.'));

function startSession(){
  loginCard.classList.add('invisible');
  show(gameUi);
  welcomeEl.textContent = `Welcome, ${currentUser}!`;
  loggedAs.textContent = `Logged in as: ${currentUser}`;
  // presence
  const presRef = db.ref('presence/' + currentUser);
  presRef.set(true);
  presRef.onDisconnect().set(false);
  // invitations listener
  listenInvitations();
  // theme and announcements listeners
  listenTheme();
  listenAnnouncements();
  loadProgress();
  populateOpponents();
  // start timer (loadProgress will set playSeconds before this runs in practice)
  startPlayTimer();
}

/* logout - clears persisted sign-in and presence */
logoutBtn.addEventListener('click', ()=>{
  if(currentUser){
    try { localStorage.removeItem('zezo_clicker_user'); } catch(e){}
    db.ref('presence/'+currentUser).set(false).catch(()=>{});
  }
  // stop timer and save immediately
  stopPlayTimer();
  if(currentUser) saveProgress();
  location.reload();
});

/* reset */
resetBtn.addEventListener('click', ()=>{
  if(!currentUser) return;
  if(!confirm('Reset your progress? This will remove money, medals, and goals.')) return;
  db.ref('users/'+currentUser).set({money:0, goal:7000, medals:[], resets:0, bestCPS:0, playSeconds:0}).then(()=>{
    money=0; goal=7000; medals=[]; resets=0; clickValue=1; bestCPS=0; clickTimestamps=[]; playSeconds=0; refreshUI();
  }).catch(()=>alert('Reset failed'));
});

/* ========== GAME: clicks, medals ========== */
// ensure pointer events and improved touch handling
function onGamePointerDown(ev){
  if(!currentUser) return;
  if(currentRoomId) return; // while in duel, disable main clicks
  const rect = gameArea.getBoundingClientRect();
  const clientX = (ev.touches && ev.touches[0]) ? ev.touches[0].clientX : (ev.clientX || ev.pageX);
  const clientY = (ev.touches && ev.touches[0]) ? ev.touches[0].clientY : (ev.clientY || ev.pageY);
  const x = clientX - rect.left;
  const y = clientY - rect.top;
  makeRipple(x,y);
  addMoney(clickValue);
}

// support both pointer and touchstart for broader compatibility
gameArea.addEventListener('pointerdown', onGamePointerDown);
gameArea.addEventListener('touchstart', function(e){ e.preventDefault(); onGamePointerDown(e); }, {passive:false});

function addMoney(amount){
  money = (money||0) + amount;
  // add click timestamp for CPS calc
  clickTimestamps.push(Date.now());
  updateCPS();
  checkGoal();
  animateMoney(money);
  throttleSave();
}

/* CPS calculation and record checks */
function updateCPS(){
  const now = Date.now();
  clickTimestamps = clickTimestamps.filter(t=> now - t <= 1000);
  const cps = clickTimestamps.length;
  lastCPS = cps;
  cpsEl.textContent = cps;
  clickValueEl.textContent = clickValue;
  checkCPSRecords(cps);
}

function checkCPSRecords(cps){
  // *** Updated behavior: award medals ONLY for multiples of 10 CPS (10, 20, 30...)
  // This avoids awarding medals for 1,2,3... personal bests. We still track the personal best number
  // but medals are only created when the CPS value is a multiple of 10.

  if (cps >= 10 && cps % 10 === 0) {
    const type = 'cps_' + cps;
    if(!hasMedalType(type)){
      awardMedal(type, `${cps} CPS!`, `You reached exactly ${cps} clicks/sec.`);
    }
  }

  // update personal best value (no medal unless it's a multiple of 10)
  if(cps > (bestCPS || 0)){
    const prev = bestCPS || 0;
    bestCPS = cps;
    // give an extra 'personal best' medal only if the new personal best is a multiple of 10
    if (cps >= 10 && cps % 10 === 0) {
      awardMedal('best_cps_' + nowTs(), `New CPS Record: ${cps}`, `You set a new personal best of ${cps} clicks/sec (previous ${prev}).`);
    }
  }
}

function hasMedalType(type){
  return medals.some(m => m.type === type);
}

/* Flash medal area instead of showing a pop-up */
function flashMedalArea(){
  const targets = [];
  if(medalsPanel) targets.push(medalsPanel);
  if(medalStatContainer) targets.push(medalStatContainer);
  targets.forEach(t=>{
    // ensure it's visible enough to see flash — do not force open panel, we only flash what is visible
    t.classList.add('medal-flash');
    const onEnd = function(){ t.classList.remove('medal-flash'); t.removeEventListener('animationend', onEnd); };
    t.addEventListener('animationend', onEnd);
    // fallback removal after 1400ms in case animationend doesn't fire on some old browsers
    setTimeout(()=> t.classList.remove('medal-flash'), 1400);
  });
}

function awardMedal(type, label, reason){
  // create medal and push
  const id = uid();
  const time = new Date().toISOString();
  const medal = { id, type, label, reason, time };
  medals.push(medal);
  // NO admin popups for medals. Flash the medal area instead.
  flashMedalArea();
  refreshUI();
  throttleSave();
}

/* goal check & medals awarding */
function checkGoal(){
  if(money >= goal){
    const id = (medals.length||0) + 1;
    const label = `Medal #${id}`;
    const time = new Date().toISOString();
    medals.push({id: uid(), label, time, reason: `Reached goal of $${goal}`});
    // carryover
    money = money - goal;
    // increase goal
    goal = goal + 500;
    // resets and clickValue progression
    resets = (resets||0) + 1;
    clickValue = (resets === 0) ? 1 : resets * 5;
    // update info panel
    spinFeedback.textContent = `Goal reached! ${label} — click value: ${clickValue}`;
    // flash medal area when goal medal earned
    flashMedalArea();
    refreshUI();
    throttleSave();
  }
}

/* medals UI (draggable 3D + hold-to-delete) */
medalsOpen.addEventListener('click', ()=>{
  medalsPanel.style.display = medalsPanel.style.display === 'none' ? 'block' : 'none';
  renderMedals();
});

function renderMedals(){
  medalsList.innerHTML = '';
  medalCountEl.textContent = medals.length;
  if(!medals || medals.length === 0){
    medalsList.innerHTML = '<div class="muted" style="padding:12px">No medals yet — reach the goal to earn medals or break records.</div>';
    return;
  }
  // show newest first
  medals.slice().reverse().forEach(m=>{
    const wrap = document.createElement('div'); wrap.className = 'medal-card card';
    wrap.style.padding = '8px';
    wrap.style.position = 'relative';
    const inner = document.createElement('div'); inner.className = 'medal-inner medal-draggable';
    inner.style.background = 'transparent';
    inner.style.height = '100%';
    inner.style.display = 'block';

    const front = document.createElement('div'); front.className='medal-front shiny';
    front.style.borderRadius='12px';
    front.innerHTML = `<div style="font-size:18px;display:flex;flex-direction:column;gap:6px;align-items:center"><div>${m.label}</div><div style="font-size:12px;font-weight:700;color:rgba(0,0,0,0.5)">${new Date(m.time).toLocaleString()}</div></div>`;

    const back = document.createElement('div'); back.className='medal-back';
    back.innerHTML = `<div style="font-size:12px">Reason</div><div style="font-size:14px">${m.reason || '—'}</div><div style="font-size:10px;color:rgba(255,255,255,0.35);margin-top:6px">${new Date(m.time).toLocaleString()}</div>`;

    inner.appendChild(front); inner.appendChild(back);
    wrap.appendChild(inner);
    medalsList.appendChild(wrap);

    // flip on click
    let flipped=false;
    wrap.addEventListener('click', ()=>{
      // small guard: if dragging skip
      if(wrap._longPressActive) return; // ignore click if long-press was processed
      flipped = !flipped;
      inner.style.transform = flipped ? 'rotateY(180deg)' : 'rotateY(0deg)';
    });

    // long-press to delete (700ms)
    let pressTimer = null;
    const startPress = (e) => {
      e.preventDefault();
      wrap._longPressActive = false;
      if(pressTimer) clearTimeout(pressTimer);
      pressTimer = setTimeout(()=>{
        wrap._longPressActive = true;
        const ok = confirm('Delete this medal? This cannot be undone.');
        if(ok){
          medals = medals.filter(mm => mm.id !== m.id);
          saveProgress();
          renderMedals();
          showTempMessage('Medal deleted');
        }
      }, 700);
    };
    const cancelPress = ()=>{ if(pressTimer) { clearTimeout(pressTimer); pressTimer = null; } };

    wrap.addEventListener('pointerdown', startPress);
    wrap.addEventListener('pointerup', cancelPress);
    wrap.addEventListener('pointercancel', cancelPress);
    wrap.addEventListener('pointerleave', cancelPress);

    // draggable rotation
    let dragging=false, sx=0, sy=0, rx=0, ry=0;
    inner.addEventListener('pointerdown', e=>{
      dragging=true; sx=e.clientX; sy=e.clientY;
      inner.setPointerCapture(e.pointerId);
    });
    window.addEventListener('pointerup', e=>{
      if(dragging){ dragging=false; }
    });
    window.addEventListener('pointermove', e=>{
      if(!dragging) return;
      const dx = e.clientX - sx;
      const dy = e.clientY - sy;
      ry = (ry + dx*0.3) % 360;
      rx = Math.max(-60, Math.min(60, rx + dy*0.25));
      inner.style.transform = `rotateY(${ry}deg) rotateX(${rx}deg)`;
      sx = e.clientX; sy = e.clientY;
    });
    inner.addEventListener('touchstart', e=>{
      dragging=true; sx = e.touches[0].clientX; sy = e.touches[0].clientY;
    }, {passive:true});
    window.addEventListener('touchend', ()=> dragging=false, {passive:true});
    window.addEventListener('touchmove', e=>{
      if(!dragging) return;
      const dx = e.touches[0].clientX - sx;
      const dy = e.touches[0].clientY - sy;
      ry = (ry + dx*0.3) % 360;
      rx = Math.max(-60, Math.min(60, rx + dy*0.25));
      inner.style.transform = `rotateY(${ry}deg) rotateX(${rx}deg)`;
      sx = e.touches[0].clientX; sy = e.touches[0].clientY;
    }, {passive:true});
  });
}

/* ========== SAVE / LOAD ========== */
function saveProgress(){
  if(!currentUser) return;
  const payload = { money: money||0, goal: goal||7000, medals: medals||[], resets: resets||0, bestCPS: bestCPS||0, playSeconds: playSeconds||0 };
  db.ref('users/' + currentUser).set(payload).catch(err=> console.warn('Save err', err));
}

function loadProgress(){
  if(!currentUser) return;
  db.ref('users/'+currentUser).once('value').then(snap=>{
    if(snap.exists()){
      const d = snap.val();
      money = Number(d.money || 0);
      goal = Number(d.goal || 7000);
      medals = Array.isArray(d.medals)? d.medals : (d.medals||[]);
      resets = Number(d.resets || (d && d.medals ? d.medals.length:0) ) || 0;
      bestCPS = Number(d.bestCPS || 0);
      playSeconds = Number(d.playSeconds || 0);
    } else {
      money = 0; goal = 7000; medals = []; resets = 0; bestCPS = 0; playSeconds = 0;
    }
    clickValue = (resets === 0) ? 1 : resets * 5;
    // update playtime UI
    playtimeEl.textContent = 'Playtime: ' + formatPlaytime(playSeconds);
    // Award any missed playtime medals up to the current stored playSeconds
    awardPlaytimeMedalsUpTo(playSeconds);
    refreshUI();
  }).catch(e=>{
    console.warn('Load fail', e);
    money=0; goal=7000; medals=[]; resets=0; clickValue=1; bestCPS=0; playSeconds=0;
    refreshUI();
  });
}

/* save on unload */
window.addEventListener('beforeunload', ()=> {
  if(currentUser) db.ref('users/'+currentUser).set({money:money||0,goal:goal||7000,medals:medals,resets:resets,bestCPS:bestCPS, playSeconds: playSeconds||0});
});

/* ========== CHALLENGE SYSTEM ========== */
function populateOpponents(){
  opponentSelect.innerHTML = '';
  USERS.forEach(u => { if(u===currentUser) return; const opt = document.createElement('option'); opt.value=u; opt.textContent=u; opponentSelect.appendChild(opt); });
}

challengeOpen.addEventListener('click', ()=>{
  if(!currentUser) return alert('Login first');
  populateOpponents();
  challengeMsg.textContent = '';
  show(challengeModal);
});
challengeCancel.addEventListener('click', ()=> hide(challengeModal));

challengeSend.addEventListener('click', ()=>{
  const opponent = opponentSelect.value;
  const clicks = Number(clicksSelect.value);
  let bet = Number(betInput.value) || 0;
  if(!opponent || opponent === currentUser) { challengeMsg.textContent = 'Choose an opponent'; return; }
  if(clicks < 10) { challengeMsg.textContent = 'Invalid clicks'; return; }
  if(bet < 500) { challengeMsg.textContent = 'Min bet 500$'; return; }

  const initiatorMoneyRef = db.ref('users/' + currentUser + '/money');
  initiatorMoneyRef.transaction(current => {
    if(current === null) current = 0;
    if(current >= bet) return current - bet;
    return;
  }, (err, committed, snap) => {
    if(err || !committed){
      challengeMsg.textContent = 'coming soon...';
      return;
    }
    const invId = uid();
    const roomId = 'room_' + uid();
    const invitation = { from: currentUser, clicks, bet, id: invId, roomId, ts: Date.now() };
    db.ref('invitations/' + opponent + '/' + invId).set(invitation).then(()=>{
      challengeMsg.textContent = 'Invitation sent. Waiting for response...';
      const roomRef = db.ref('rooms/' + roomId);
      roomRef.on('value', snapRoom => {
        const r = snapRoom.val();
        if(!r) return;
        if(r.started){
          hide(challengeModal);
          openDuel(roomId, r);
        }
      });
      setTimeout(()=> {
        db.ref('invitations/' + opponent + '/' + invId).get().then(s=>{
          if(s.exists()){
            db.ref('invitations/' + opponent + '/' + invId).remove();
            db.ref('users/' + currentUser + '/money').transaction(m => (m||0) + bet);
            challengeMsg.textContent = 'No response. Bet refunded.';
          }
        });
      }, 60000);
    }).catch(e => {
      console.warn('Invite write fail', e);
      db.ref('users/' + currentUser + '/money').transaction(m => (m||0) + bet);
      challengeMsg.textContent = 'Failed to send invitation - refunded';
    });
  });
});

/* Listen for incoming invitations */
function listenInvitations(){
  if(!currentUser) return;
  const invRef = db.ref('invitations/' + currentUser);
  invRef.off();
  invRef.on('child_added', snap => {
    const inv = snap.val(); inv._key = snap.key;
    currentInvitation = inv;
    incomingInfo.textContent = `${inv.from} invites you: ${inv.clicks} clicks — bet $${inv.bet}`;
    show(incomingModal);
  });
}

/* decline invite */
declineInvite.addEventListener('click', ()=>{
  if(!currentInvitation) { hide(incomingModal); return; }
  const inv = currentInvitation;
  db.ref('invitations/' + currentUser + '/' + inv._key).remove();
  db.ref('users/' + inv.from + '/money').transaction(m => (m||0) + inv.bet);
  currentInvitation = null;
  hide(incomingModal);
});

/* accept invite */
acceptInvite.addEventListener('click', ()=>{
  if(!currentInvitation) return;
  const inv = currentInvitation;
  const myMoneyRef = db.ref('users/' + currentUser + '/money');
  myMoneyRef.transaction(current => {
    if(current === null) current = 0;
    if(current >= inv.bet) return current - inv.bet;
    return;
  }, (err, committed, snap) => {
    if(err || !committed){
      db.ref('invitations/' + inv.from + '/' + inv.id).remove().catch(()=>{});
      db.ref('users/' + inv.from + '/money').transaction(m => (m||0) + inv.bet);
      alert('Not enough money to accept. Invitation cancelled.');
      currentInvitation = null;
      hide(incomingModal);
      return;
    }
    const roomData = {
      players: { a: inv.from, b: currentUser },
      target: inv.clicks,
      bet: inv.bet,
      started: true,
      counts: { [inv.from]: 0, [currentUser]: 0 },
      ts: Date.now()
    };
    db.ref('rooms/' + inv.roomId).set(roomData).then(()=>{
      db.ref('invitations/' + currentUser + '/' + inv._key).remove().catch(()=>{});
      db.ref('invitations/' + inv.from + '/' + inv.id).remove().catch(()=>{});
      currentInvitation = null;
      hide(incomingModal);
      openDuel(inv.roomId, roomData);
    }).catch(e=>{
      console.warn('Create room failed', e);
      db.ref('users/' + currentUser + '/money').transaction(m => (m||0) + inv.bet);
      db.ref('users/' + inv.from + '/money').transaction(m => (m||0) + inv.bet);
      alert('Failed to start duel. Bets refunded.');
      currentInvitation = null;
      hide(incomingModal);
    });
  });
});

/* openDuel */
function openDuel(roomId, roomData){
  currentRoomId = roomId;
  show(duelModal);
  duelTitle.textContent = `Duel: ${roomData.players.a} vs ${roomData.players.b}`;
  duelTarget.textContent = `Target: ${roomData.target} clicks — Bet: $${roomData.bet} each`;
  duelYourCount.textContent = '0'; duelOpCount.textContent = '0'; duelResult.textContent = '';

  const roomRef = db.ref('rooms/' + roomId);
  const onRoomValue = roomRef.on('value', snap=>{
    const r = snap.val();
    if(!r) return;
    const counts = r.counts || {};
    const yourCount = counts[currentUser] || 0;
    const otherUser = (r.players.a === currentUser) ? r.players.b : r.players.a;
    const otherCount = counts[otherUser] || 0;
    duelYourCount.textContent = yourCount;
    duelOpCount.textContent = otherCount;
    if(r.winner){
      const winner = r.winner;
      if(r.awarded !== true){
        db.ref('users/' + winner + '/money').transaction(m => (m||0) + (r.bet * 2));
        roomRef.update({ awarded: true });
      }
      duelResult.textContent = (winner === currentUser) ? 'You won! Prize added.' : `You lost. ${winner} won.`;
      setTimeout(()=> { closeDuel(roomId); refreshUI(); }, 3500);
    }
  });
  activeRoomListeners[roomId] = onRoomValue;

  duelClick.onclick = () => {
    if(!currentRoomId) return;
    const countRef = db.ref(`rooms/${roomId}/counts/${currentUser}`);
    countRef.transaction(cur => ( (cur||0) + 1 ), (err, committed, snap)=>{
      if(err || !committed) return;
      const newVal = snap.val();
      db.ref(`rooms/${roomId}`).once('value').then(s => {
        const r = s.val();
        if(!r) return;
        const target = r.target;
        if(newVal >= target && !r.winner){
          db.ref(`rooms/${roomId}/winner`).set(currentUser);
        }
      });
    });
  };
}

function closeDuel(roomId){
  hide(duelModal);
  if(roomId && activeRoomListeners[roomId]){
    db.ref('rooms/' + roomId).off('value', activeRoomListeners[roomId]);
    delete activeRoomListeners[roomId];
  }
  currentRoomId = null;
  duelClick.onclick = null;
}

duelLeave.addEventListener('click', ()=> { if(!currentRoomId) hide(duel-modal); else { closeDuel(currentRoomId); hide(duel-modal); } });

/* ========== ANNOUNCEMENTS (controller -> game) ========== */
function listenAnnouncements(){
  if(!currentUser) return;
  const annRef = db.ref('announcements').orderByChild('ts');
  annRef.off();
  annRef.once('value').then(snap => {
    const data = snap.val() || {};
    const arr = Object.values(data).sort((a,b)=> a.ts - b.ts);
    arr.forEach(a => handleAnnouncement(a));
  });
  db.ref('announcements').on('child_added', snap => {
    const a = snap.val();
    handleAnnouncement(a);
  });
  db.ref('announcements').on('child_removed', snap => {
    const id = snap.key;
    const el = document.getElementById('ann_' + id);
    if(el) el.remove();
  });
}

function handleAnnouncement(a){
  if(!a || !a.id) return;
  if(a.seen && a.seen[currentUser]) return;
  displayAnnouncement(a);
  db.ref(`announcements/${a.id}/seen/${currentUser}`).set(true).catch(e=> console.warn('mark seen failed', e));
}

function displayAnnouncement(a){
  const id = a.id || ('ann_' + Math.random().toString(36).slice(2,9));
  const el = document.createElement('div');
  el.className = 'admin-msg';
  el.id = 'ann_' + id;
  el.innerHTML = `<div class="admin-from">${a.from || 'Admin'}</div><div class="admin-text" style="text-align:right">${a.text || ''}</div><div class="admin-expire muted">Hiding in ${Math.ceil((a.durationSec||8))}s</div>`;
  adminMessagesContainer.prepend(el);
  let remaining = Math.max(1, Number(a.durationSec || 8));
  const expireLabel = el.querySelector('.admin-expire');
  expireLabel.textContent = `Hiding in ${remaining}s`;
  const interval = setInterval(()=> {
    remaining--;
    if(remaining <= 0){
      clearInterval(interval);
      el.remove();
      return;
    }
    expireLabel.textContent = `Hiding in ${remaining}s`;
  }, 1000);
  setTimeout(()=> { el.remove(); clearInterval(interval); }, (a.durationSec || 8) * 1000 + 150);
}

/* ========== THEME HANDLING (controller -> game) ========== */
function listenTheme(){
  const themeRef = db.ref('theme/current');
  themeRef.off();
  themeRef.on('value', snap => {
    const t = snap.val();
    if(!t) return applyTheme('original', null);
    applyThemePayload(t);
  });
}

function applyThemePayload(payload){
  if(!payload) return;
  const name = payload.name || 'original';
  const p = payload.presets || null;
  applyTheme(name, p);
}

let discoInterval = null;
function applyTheme(name, presets=null){
  if(discoInterval) { clearInterval(discoInterval); discoInterval = null; }
  const known = {
    original: { bg: ['#071022','#001d2d'], btn: '#06b6d4' },
    red: { bg: ['#2b0216','#3b071f'], btn: '#ff3b3b' },
    green: { bg: ['#021b0b','#054d2c'], btn: '#16a34a' },
    blue: { bg: ['#021033','#03396b'], btn: '#3b82f6' },
    pink: { bg: ['#2b0216','#3b0630'], btn: '#ec4899' },
    purple: { bg: ['#0b021a','#21063a'], btn: '#8b5cf6' },
    yellow: { bg: ['#2b2300','#3b2c00'], btn: '#f59e0b' },
    black: { bg: ['#000000','#0a0a0a'], btn: '#111111' },
    disco: { bg: ['#ff3b3b','#f97316','#facc15','#34d399','#60a5fa'], btn: 'disco' }
  };
  const preset = presets || (known[name] || known.original);
  if(name === 'disco' || preset.btn === 'disco'){
    let i = 0;
    discoInterval = setInterval(()=>{
      const colors = preset.bg;
      const a = colors[i % colors.length];
      const b = colors[(i+1) % colors.length];
      document.documentElement.style.setProperty('--bg-a', a);
      document.documentElement.style.setProperty('--bg-b', b);
      document.documentElement.style.setProperty('--cta', colors[(i+2) % colors.length]);
      i++;
    }, 600);
  } else {
    document.documentElement.style.setProperty('--bg-a', preset.bg[0] || '#071022');
    document.documentElement.style.setProperty('--bg-b', preset.bg[1] || (preset.bg[0] || '#001d2d'));
    document.documentElement.style.setProperty('--cta', preset.btn || '#ff8a00');
  }
}

/* ========== LISTENERS / INIT ========== */
usernameInp.addEventListener('keydown', e=> { if(e.key==='Enter') passwordInp.focus(); });
passwordInp.addEventListener('keydown', e=> { if(e.key==='Enter') loginBtn.click(); });

/* ========== POPULATE USERS (for challenges) ========== */
// populateOpponents defined above

/* ========== REFRESH UI ========== */
function refreshUI(){
  animateMoney(money||0);
  goalEl.textContent = goal;
  medalCountEl.textContent = medals.length;
  renderMedals();
  cpsEl.textContent = lastCPS || 0;
  clickValueEl.textContent = clickValue || 1;
  playtimeEl.textContent = 'Playtime: ' + formatPlaytime(playSeconds);
}

/* ========== INITIALIZE ========== */
(function init(){
  hide(gameUi);
  medalsPanel.style.display = 'none';
  applyTheme('original');

  // Auto-login if keep-signed was used previously
  try {
    const saved = localStorage.getItem('zezo_clicker_user');
    if(saved && USERS.includes(saved)){
      currentUser = saved;
      // Mark checkbox visually on login card for user's awareness
      keepSignedChk.checked = true;
      startSession();
    }
  } catch(e){
    // ignore localStorage errors
  }
})();

// accessibility: allow keyboard activation of the game area for desktop users
gameArea.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' || e.key === ' ') onGamePointerDown({ clientX: gameArea.clientWidth/2, clientY: gameArea.clientHeight/2, touches: null }); });

</script>
<button id="hello-btn" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 20px 40px; font-size: 24px; cursor: pointer;">hello</button>

<audio id="looping-audio" src="brainrot.mp3" loop></audio>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const helloButton = document.getElementById('hello-btn');
        const loopingAudio = document.getElementById('looping-audio');

        if (helloButton && loopingAudio) {
            helloButton.addEventListener('click', () => {
                loopingAudio.play();
                helloButton.style.display = 'none';
            });
        }
    });
</script>
</body>
</html>
